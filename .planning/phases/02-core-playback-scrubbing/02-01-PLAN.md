---
phase: 02-core-playback-scrubbing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/constants.ts
  - src/components/ControlBar.tsx
  - src/components/ScrubberShell.tsx
  - src/lib/settings.ts
  - src/lib/urlState.ts
autonomous: true

must_haves:
  truths:
    - "User can toggle between normal speed (1x) and slow-motion with a single button click"
    - "Jump buttons (1s/5s/10s) work correctly for backward and forward navigation"
    - "Step preset controls are completely removed from UI"
    - "Settings persist slow-mo speed preference in localStorage"
  artifacts:
    - path: "src/lib/constants.ts"
      provides: "SLOW_MO_SPEED constant and removal of STEP_PRESETS"
      min_lines: 15
    - path: "src/components/ControlBar.tsx"
      provides: "Slow-mo toggle button replacing speed dropdown"
      exports: ["ControlBar"]
    - path: "src/lib/settings.ts"
      provides: "Settings storage for slowMoSpeed"
      contains: "slowMoSpeed"
  key_links:
    - from: "src/components/ControlBar.tsx"
      to: "controller.setPlaybackRate"
      via: "toggleSpeed function"
      pattern: "setPlaybackRate"
    - from: "src/components/ScrubberShell.tsx"
      to: "src/lib/settings.ts"
      via: "saveSettings with slowMoSpeed"
      pattern: "saveSettings.*slowMoSpeed"
---

<objective>
Replace frame-step presets with fixed-second jumps and convert speed dropdown to slow-mo toggle.

Purpose: Simplify controls by removing frame-stepping (confusing for film review) and making speed switching instant via toggle instead of dropdown selection.

Output: Clean UI with jump buttons (1s/5s/10s), slow-mo toggle, and no step preset controls.
</objective>

<execution_context>
@C:\Users\Daniel\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Daniel\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@h:/film/.planning/PROJECT.md
@h:/film/.planning/ROADMAP.md
@h:/film/.planning/STATE.md
@h:/film/.planning/phases/01-touch-native-foundation/01-01-SUMMARY.md
@h:/film/.planning/phases/01-touch-native-foundation/01-02-SUMMARY.md
@h:/film/src/lib/constants.ts
@h:/film/src/components/ControlBar.tsx
@h:/film/src/components/ScrubberShell.tsx
</context>

<tasks>

<task type="auto">
  <name>Remove step preset system from constants and add slow-mo config</name>
  <files>src/lib/constants.ts</files>
  <action>
1. Remove `STEP_PRESETS` constant and `StepPresetKey` type export (no longer needed)
2. Add `SLOW_MO_SPEED` constant with default value of 0.25 (configurable slow-mo speed)
3. Keep `JUMP_AMOUNTS` unchanged (already correct: [1, 5, 10] seconds)
4. Keep `KEYBOARD_MAP` unchanged (will be used in Phase 3)

The constant should look like:
```typescript
export const SLOW_MO_SPEED = {
  default: 0.25,
  min: 0.1,
  max: 0.75,
} as const;
```

This allows users to configure slow-mo speed (default 0.25x = quarter speed for frame-by-frame review).
  </action>
  <verify>Run `npm run build` to ensure TypeScript compiles without errors from removed StepPresetKey references</verify>
  <done>STEP_PRESETS removed, SLOW_MO_SPEED constant added, build succeeds</done>
</task>

<task type="auto">
  <name>Update settings storage to replace stepPreset with slowMoSpeed</name>
  <files>src/lib/settings.ts, src/lib/urlState.ts</files>
  <action>
1. In `src/lib/settings.ts`:
   - Remove `stepPreset` field from Settings type
   - Add `slowMoSpeed: number` field to Settings type
   - Update `DEFAULT_SETTINGS` to include `slowMoSpeed: SLOW_MO_SPEED.default` (import from constants)
   - Remove `stepPreset` from loadSettings/saveSettings

2. In `src/lib/urlState.ts`:
   - Remove `stepPreset` from UrlState type
   - Add `slowMoSpeed?: number` to UrlState type
   - Update `parseUrlState` to parse `slowMo` query param as number
   - Update `buildSearchParams` to include `slowMo` param
   - Update `applyUrlStateToSettings` to apply `slowMoSpeed` instead of `stepPreset`

This ensures settings storage and URL state reflect the new slow-mo system instead of step presets.
  </action>
  <verify>Run `npm run build` to ensure types are correct and no compilation errors</verify>
  <done>Settings and URL state updated to use slowMoSpeed instead of stepPreset, build succeeds</done>
</task>

<task type="auto">
  <name>Replace speed dropdown with slow-mo toggle and remove step controls from UI</name>
  <files>src/components/ControlBar.tsx, src/components/ScrubberShell.tsx</files>
  <action>
**In ControlBar.tsx:**

1. Remove imports: `STEP_PRESETS`, `StepPresetKey`
2. Import: `SLOW_MO_SPEED` from constants
3. Remove props: `stepPreset`, `onStepPresetChange`
4. Add props: `slowMoSpeed: number`, `onSlowMoSpeedChange?: (speed: number) => void`, `isSlowMo: boolean`, `onToggleSlowMo?: () => void`
5. Remove `STEP_LABELS` constant (no longer needed)
6. Remove speed dropdown select element (lines 111-124)
7. Add slow-mo toggle button after play/pause button:
```tsx
<button
  type="button"
  onClick={onToggleSlowMo}
  className={`select-none touch-manipulation rounded px-3 py-2.5 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-zinc-400 focus:ring-offset-2 active:scale-95 ${
    isSlowMo
      ? "bg-amber-600 text-white active:bg-amber-700 dark:bg-amber-500 dark:active:bg-amber-600"
      : "bg-zinc-800 text-white active:bg-zinc-900 dark:bg-zinc-200 dark:text-zinc-900 dark:active:bg-zinc-100"
  } disabled:opacity-50`}
  disabled={!canControl}
  aria-label={isSlowMo ? "Switch to normal speed" : "Switch to slow motion"}
>
  {isSlowMo ? `${slowMoSpeed}× Slow` : "1× Normal"}
</button>
```
8. Remove step preset select (lines 133-146)
9. Remove step buttons (−/+ buttons, lines 147-164)
10. Keep jump buttons unchanged (already correct)
11. Keep hold buttons unchanged
12. Remove hold tick rate input (lines 219-232) — will be replaced with scrub speed multiplier in plan 02-02

**In ScrubberShell.tsx:**

1. Remove: `stepPreset` state and `StepPresetKey` import
2. Add: `slowMoSpeed` state initialized to `SLOW_MO_SPEED.default`
3. Add: `isSlowMo` state initialized to `false`
4. Update loadSettings effect to load `slowMoSpeed` instead of `stepPreset`
5. Update saveSettings effect to save `slowMoSpeed` instead of `stepPreset`
6. Update URL state handling to use `slowMoSpeed` instead of `stepPreset`
7. Add `toggleSlowMo` function:
```typescript
const toggleSlowMo = () => {
  const newIsSlowMo = !isSlowMo;
  setIsSlowMo(newIsSlowMo);
  const newSpeed = newIsSlowMo ? slowMoSpeed : 1;
  setSpeed(newSpeed);
  controller.setPlaybackRate(newSpeed);
};
```
8. Update `useScrubberControls` call: remove `stepPreset` param (will be updated in plan 02-02)
9. Update `ControlBar` props: remove `stepPreset`/`onStepPresetChange`, add `slowMoSpeed`/`onSlowMoSpeedChange`/`isSlowMo`/`onToggleSlowMo`

Use Phase 1 button patterns:
- `select-none touch-manipulation` on all buttons
- `py-2.5` minimum padding for 44px tap targets
- `active:scale-95 active:bg-*` for press feedback
- Amber colors for slow-mo active state (distinct from normal black/white buttons)
  </action>
  <verify>Run `npm run dev`, load a video, verify: (1) slow-mo toggle switches between 1x and 0.25x, (2) jump buttons work, (3) step preset controls gone, (4) build has no errors</verify>
  <done>Speed dropdown replaced with slow-mo toggle, step controls removed, UI shows only play/pause, slow-mo toggle, jump buttons, hold buttons, settings persist</done>
</task>

</tasks>

<verification>
1. Run `npm run build` — no TypeScript errors
2. Run `npm run dev` — app starts successfully
3. Load YouTube video
4. Click slow-mo toggle — speed changes to 0.25x (audio pitch changes, video slows)
5. Click again — speed returns to 1x
6. Click jump buttons (−1s, +1s, −5s, +5s, −10s, +10s) — video jumps correctly
7. Refresh page — slow-mo preference persists
8. Check ControlBar — no step preset dropdown, no step buttons, no hold tick rate input visible
</verification>

<success_criteria>
- Slow-mo toggle button appears in ControlBar after play/pause
- Toggle switches between 1x (normal) and 0.25x (slow-mo) instantly
- Jump buttons (1s/5s/10s forward/back) all work correctly
- Step preset controls completely removed from UI
- Slow-mo speed persists in localStorage
- No TypeScript errors, app builds and runs
</success_criteria>

<output>
After completion, create `h:/film/.planning/phases/02-core-playback-scrubbing/02-01-SUMMARY.md` following the summary template.
</output>
