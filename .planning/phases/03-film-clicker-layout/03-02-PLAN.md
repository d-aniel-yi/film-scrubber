---
phase: 03-film-clicker-layout
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ControlBar.tsx
  - src/components/ScrubberShell.tsx
autonomous: true

must_haves:
  truths:
    - "Settings panel can be collapsed/expanded via toggle button"
    - "Settings panel contains slow-mo speed, scrub speed, and playback speed controls"
    - "Settings state (expanded/collapsed) persists across page refreshes"
    - "Settings panel is collapsed by default to reduce visual clutter"
  artifacts:
    - path: "src/components/ControlBar.tsx"
      provides: "Collapsible settings panel with toggle button"
      contains: "isSettingsExpanded.*setSettingsExpanded"
    - path: "src/components/ScrubberShell.tsx"
      provides: "Settings expanded state management"
      contains: "settingsExpanded"
  key_links:
    - from: "Settings toggle button"
      to: "Settings panel visibility"
      via: "isSettingsExpanded state"
      pattern: "onClick.*setSettingsExpanded"
    - from: "Settings panel"
      to: "Setting controls (slow-mo, scrub, playback speed)"
      via: "Conditional render based on isSettingsExpanded"
      pattern: "isSettingsExpanded.*&&"
---

<objective>
Add collapsible settings panel with toggle button to ControlBar. Panel contains slow-mo speed, scrub speed, and playback speed controls. Collapsed by default to reduce visual clutter while keeping controls accessible.

Purpose: Film clicker users need quick access to speed settings without cluttering the main controls. Collapsible panel solves this by hiding settings until needed while keeping them one tap away.

Output: ControlBar with collapsible settings panel and ScrubberShell managing expanded state.
</objective>

<execution_context>
@C:\Users\Daniel\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Daniel\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@h:\film\.planning\PROJECT.md
@h:\film\.planning\ROADMAP.md
@h:\film\.planning\STATE.md
@h:\film\src\components\ControlBar.tsx
@h:\film\src\components\ScrubberShell.tsx
@h:\film\src\lib\settings.ts
</context>

<tasks>

<task type="auto">
  <name>Add collapsible settings panel to ControlBar</name>
  <files>src/components/ControlBar.tsx, src/components/ScrubberShell.tsx</files>
  <action>
**In ScrubberShell.tsx:**
1. Add state: `const [settingsExpanded, setSettingsExpanded] = useState(false);`
2. Pass to ControlBar props: `settingsExpanded={settingsExpanded}` and `onSettingsExpandedChange={setSettingsExpanded}`

**In ControlBar.tsx:**
1. Add to ControlBarProps type: `settingsExpanded?: boolean` and `onSettingsExpandedChange?: (expanded: boolean) => void`
2. Add "Settings" toggle button after jump buttons row:
   - Text: "Settings ▼" when collapsed, "Settings ▲" when expanded
   - onClick: `() => onSettingsExpandedChange?.(!settingsExpanded)`
   - Classes: Same touch-native button styles as other buttons
   - Full width on mobile: `w-full sm:w-auto`
3. Move existing settings controls (slow-mo speed input, scrub speed input) into settings panel:
   - Wrap in div with conditional render: `{settingsExpanded && (<div className="flex flex-col gap-2 w-full">...</div>)}`
   - Add playback speed dropdown/input to settings panel (currently missing from UI):
     - Label: "Playback speed"
     - Uses `speed` prop and `onSpeedChange` callback
     - Renders available rates from `controller.getAvailablePlaybackRates()`
     - Shows as dropdown or number input based on available rates
4. Keep settings panel at bottom of control bar stack

Note: Settings expanded state does NOT persist to localStorage for now (can be added later if needed).
  </action>
  <verify>
1. Load app with video
2. Verify Settings button appears at bottom of controls
3. Click Settings button → panel expands showing slow-mo speed, scrub speed, playback speed
4. Click Settings button again → panel collapses
5. Adjust each setting in expanded panel → verify changes apply correctly
6. Refresh page → verify settings panel starts collapsed
  </verify>
  <done>
Settings panel collapses/expands via toggle button. Panel contains slow-mo speed, scrub speed, and playback speed controls. Panel is collapsed by default. All settings still functional.
  </done>
</task>

</tasks>

<verification>
## Settings Panel Check
1. Settings button appears and is tappable on mobile/desktop
2. Settings panel expands/collapses correctly
3. All three settings (slow-mo, scrub, playback) appear in panel when expanded
4. Settings changes still apply correctly
5. Panel starts collapsed on page load
</verification>

<success_criteria>
- LAYOUT-03 implemented: Settings panel collapses/expands via toggle button
- LAYOUT-04 implemented: Settings panel contains slow-mo speed, scrub speed, and playback speed controls
- Settings panel collapsed by default
- All settings remain functional
</success_criteria>

<output>
After completion, create `.planning/phases/03-film-clicker-layout/03-02-SUMMARY.md`
</output>
